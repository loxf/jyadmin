<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>直接在界面上修改，点击刷新菜单即可生效
    </legend>
</fieldset>
<blockquote class="layui-elem-quote">
    注意：<br>
    此处菜单配置和微信菜单的结构是一致的：<br>
    最下面（淡蓝色）是一级菜单，然后依次往上是二级菜单（灰色），最多5个，请依次填写。<br>
    一级菜单如果没有子菜单，请务必填写链接，如果有子菜单，则不用填写对应的链接。<br>
    目前只支持共两级菜单，且菜单只能是view类型（文本+菜单）。
</blockquote>
<table class="layui-table" id="menu_table">
    <colgroup>
        <col width="33%">
        <col width="33%">
        <col width="33%">
    </colgroup>
    <tbody>
    <tr class="table-info second-menu" data-id="5" bgcolor="#F0F0F0">
        <td data-id="1-5">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="2-5" bgcolor="#FFFFFF">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="3-5">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
    </tr>
    <tr class="table-info second-menu" data-id="4" bgcolor="#F0F0F0">
        <td data-id="1-4">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="2-4" bgcolor="#FFFFFF">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="3-4">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
    </tr>
    <tr class="table-info second-menu" data-id="3" bgcolor="#F0F0F0">
        <td data-id="1-3">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="2-3" bgcolor="#FFFFFF">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="3-3">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
    </tr>
    <tr class="table-info second-menu" data-id="2" bgcolor="#F0F0F0">
        <td data-id="1-2">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="2-2" bgcolor="#FFFFFF">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="3-2">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
    </tr>
    <tr class="table-info second-menu" data-id="1" bgcolor="#F0F0F0">
        <td data-id="1-1">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="2-1" bgcolor="#FFFFFF">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="3-1">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="菜单链接" class="layui-input menu-url"/>
            </div>
        </td>
    </tr>
    <tr class="table-info first-menu" data-id="0" bgcolor="#96CDCD">
        <td data-id="1">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="有下级菜单时，不填此链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="2">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="有下级菜单时，不填此链接" class="layui-input menu-url"/>
            </div>
        </td>
        <td data-id="3">
            <div class="layui-inline">
                <input type="text" placeholder="菜单名称" class="layui-input menu-name"/>
            </div>
            <div class="layui-inline">
                <input type="text" placeholder="有下级菜单时，不填此链接" class="layui-input menu-url"/>
            </div>
        </td>
    </tr>
    </tbody>
</table>
<div class="layui-form-item" style="text-align: center">
    <a onclick="refreshMenu()" class="layui-btn">刷新菜单</a>
</div>

<script>
    var form = layui.form
            ,layer = layui.layer
            ,table = layui.table;

    $.ajax({
        type: "POST",
        url:"selfmenu.html",
        dataType:"json",
        success: function(data) {
            if(data.code == 1){
                var dataStr = data.data;
                var datajson = eval("("+dataStr+")");
                var selfMenu = datajson.selfmenu_info;
                var button = selfMenu.button;
                for(var i in button){
                    var btn = button[i];
                    var type = btn.type;
                    var sub_button = btn.sub_button;
                    var name = btn.name;
                    // 获取当前td
                    var td = $("#menu_table").children("tbody").children(".first-menu").eq(0).find("td").eq(i);
                    td.find("input.menu-name").val(name);
                    if(type=="view"){
                        var url = btn.url;
                        td.find("input.menu-url").val(url);
                    } else if(sub_button){
                        var listBtn = sub_button.list;
                        for(var j in listBtn){
                            var subBtn = listBtn[j];
                            var type = subBtn.type;
                            var name = subBtn.name;
                            var subtd = $("#menu_table").children("tbody").children(".second-menu").eq(4-j).find("td").eq(i);
                            subtd.find("input.menu-name").val(name);
                            if(type=="view"){
                                var url = subBtn.url;
                                subtd.find("input.menu-url").val(url);
                            } else {
                                // 非文本类型的 暂时不支持
                            }
                        }
                    } else {
                        // 非文本类型的 暂时不支持
                    }
                }
            } else {
                layer.msg(data.msg);
            }
        }
    });
    //监听提交
    function refreshMenu(data){
        var firstMenuTds = $("#menu_table").children("tbody").children(".first-menu").eq(0).find("td");
        var menus = [];
        for(var i=0; i<firstMenuTds.length; i++){
            var name = firstMenuTds.eq(i).find("input.menu-name").val();
            if(name){
                var firstMenu = {};
                firstMenu.name = name;
                var url = firstMenuTds.eq(i).find("input.menu-url").val();
                if(url){
                    firstMenu.url = url;
                    firstMenu.type = "view";
                } else {
                    // 只有view 和主菜单两种
                    firstMenu.sub_button = [];
                }
                menus[i] = firstMenu;
            }
        }
        var subtrList = $("#menu_table").children("tbody").children(".second-menu");
        for(var i=subtrList.length; i>0; i--){
            var tds = subtrList.eq(i-1).find("td");
            for(var j=0; j<tds.length; j++) {
                if(menus[j]){
                    var type = menus[j].type;
                    if(!type){
                        // 当前有父目录
                        var name = tds.eq(j).find("input.menu-name").val();
                        if(name){
                            var subMenu = {};
                            subMenu.name = name;
                            subMenu.type = "view";
                            subMenu.url = tds.eq(j).find("input.menu-url").val();
                            menus[j].sub_button[subtrList.length - i] = subMenu;
                        }
                    }
                }
            }
        }
        var param = {button : menus};
        // alert(JSON.stringify(param));
        $.ajax({
            type: "POST",
            url:"create.html",
            data : {weixinButton : JSON.stringify(param)},
            dataType:"json",
            success: function(data) {
                layer.msg(data.msg);
            }
        });
        return false;
    }
</script>
